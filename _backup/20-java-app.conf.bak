input {
  beats {
    port => 5045
    type => "java"
  }
}

filter {
  # Sadece java tipindeki logları işle
  if [type] == "java" or "java" in [tags] {
    
    # JSON parse et
    json {
      source => "message"
      remove_field => ["message"]
    }
    
    # Timestamp'i düzelt
    if [timestamp] {
      date {
        match => [ "timestamp", "ISO8601", "yyyy-MM-dd'T'HH:mm:ss'Z'", "yyyy-MM-dd'T'HH:mm:ssZ" ]
        target => "@timestamp"
      }
    }
    
    # Log level'ı büyük harfe çevir
    if [level] {
      mutate {
        uppercase => [ "level" ]
      }
    }
  }
}

output {
  if [type] == "java" or "java" in [tags] {
    elasticsearch {
      hosts => ["https://elasticsearch:9200"]
      ssl_certificate_authorities => ["/usr/share/logstash/config/certs/elastic-stack-ca.crt"]
      ssl_verification_mode => "none"
      manage_template => false
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      index => "java-app-logs-%{+YYYY.MM.dd}"
    }
    
    # Debug - konsola yazdır
    stdout {
      codec => rubydebug {
        metadata => true
      }
    }
  }
}